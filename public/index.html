<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>WebXR AR Experience</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Variant Launch SDK: enables WebXR immersive-ar on iOS and other platforms -->
    <script src="https://launchar.app/sdk/v1?key=tF9tOpUzqoCcVs7jfwxWUSBKZv6OF8zp&redirect=true"></script>
</head>
<body>
    <!-- AR Canvas Container -->
    <div id="ar-container"></div>

    <!-- Start AR Button -->
    <button id="start-button" class="start-button">Start AR</button>

    <!-- Reset Button (only visible for WebXR) -->
    <button id="reset-button" class="reset-button hidden">Reset</button>

    <!-- WebXR Instruction (shown briefly when WebXR starts) -->
    <div id="webxr-instruction" class="webxr-instruction hidden">
        <p>Point at a surface and tap to place content</p>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Load Toast Notification System first (for error display) -->
    <script src="toast.js"></script>
    
    <!-- Load Three.js and GLTFLoader as classic scripts (no ES modules) to avoid
         bare-module imports like "three" that some viewers (e.g. Variant Launch)
         cannot resolve, which was causing the "Module name, 'three' does not resolve
         to a valid URL" error. -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.min.js"></script>
    <script>
        // Verify THREE loaded correctly
        if (typeof THREE === 'undefined') {
            console.error('THREE.js failed to load!');
        } else {
            console.log('THREE.js loaded successfully, version:', THREE.REVISION);
        }
    </script>
    
    <!-- Load GLTFLoader - this attaches to THREE.GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.149.0/examples/js/loaders/GLTFLoader.js"
            onerror="console.error('GLTFLoader script failed to load from jsdelivr')"></script>
    <script>
        // Verify GLTFLoader loaded correctly and attach to THREE namespace
        (function() {
            console.log('=== GLTFLoader Verification ===');
            console.log('THREE.GLTFLoader:', typeof THREE !== 'undefined' ? typeof THREE.GLTFLoader : 'THREE not defined');
            console.log('window.GLTFLoader:', typeof window.GLTFLoader);
            
            if (typeof THREE !== 'undefined' && typeof THREE.GLTFLoader !== 'undefined') {
                console.log('✅ GLTFLoader loaded successfully on THREE.GLTFLoader');
                // Test instantiation
                try {
                    var testLoader = new THREE.GLTFLoader();
                    console.log('✅ GLTFLoader instantiation test passed');
                    window._gltfLoaderReady = true;
                } catch (e) {
                    console.error('❌ GLTFLoader instantiation failed:', e);
                    window._gltfLoaderReady = false;
                }
            } else if (typeof window.GLTFLoader !== 'undefined') {
                console.log('✅ GLTFLoader loaded on window.GLTFLoader (attaching to THREE)');
                if (typeof THREE !== 'undefined') {
                    THREE.GLTFLoader = window.GLTFLoader;
                    console.log('Attached GLTFLoader to THREE namespace');
                }
                window._gltfLoaderReady = true;
            } else {
                console.error('❌ GLTFLoader NOT loaded! Will try fallback...');
                window._gltfLoaderReady = false;
                
                // Fallback: try loading from unpkg
                var fallbackScript = document.createElement('script');
                fallbackScript.src = 'https://unpkg.com/three@0.149.0/examples/js/loaders/GLTFLoader.js';
                fallbackScript.onload = function() {
                    console.log('Fallback GLTFLoader script loaded');
                    if (typeof THREE.GLTFLoader !== 'undefined') {
                        console.log('✅ GLTFLoader now available via fallback');
                        window._gltfLoaderReady = true;
                    }
                };
                fallbackScript.onerror = function() {
                    console.error('Fallback GLTFLoader also failed to load');
                };
                document.head.appendChild(fallbackScript);
            }
        })();
    </script>

    <!-- Load Platform Detector first -->
    <script src="platform-detector.js"></script>
    
    <!-- Load AR Controller (WebXR-only, will dynamically load main-webxr.js) -->
    <script src="ar-controller.js"></script>
</body>
</html>

